<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moad Alouane — Cybersecurity Portfolio</title>
    <meta name="description" content="An interactive, Linux-desktop themed portfolio for Moad Alouane, showcasing projects in game development and cybersecurity.">
    
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <symbol id="icon-folder" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></symbol>
        <symbol id="icon-document" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></symbol>
        <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol>
        <symbol id="icon-mail" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></symbol>
        <symbol id="icon-terminal" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></symbol>
        <symbol id="icon-github" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></symbol>
        <symbol id="icon-linkedin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></symbol>
      </defs>
    </svg>

    <style>
        /* --- CORE STYLES & THEME --- */
        :root {
            --background: #0A0A0A;
            --panel: #071018;
            --accent-primary: #00FF9C;
            --accent-secondary: #FF3B3B;
            --muted-text: #9AA5B1;
            --text-color: #EFEFEF;
            --glass: rgba(20, 20, 25, 0.4);
            --border-color: rgba(0, 255, 156, 0.2);
            --glow-color: rgba(0, 255, 156, 0.5);
            --font-family: 'Menlo', 'Consolas', 'Monaco', monospace;
            --global-scale: 1.0;
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--background);
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 14px;
        }

        body.scaled {
             transform: scale(var(--global-scale));
             transform-origin: top left;
             height: calc(100% / var(--global-scale));
             width: calc(100% / var(--global-scale));
        }

        button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-family: inherit;
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
        }
        button:hover {
            background: rgba(0, 255, 156, 0.2);
            box-shadow: 0 0 8px var(--glow-color);
        }

        /* --- BOOT LOADER --- */
        #boot-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-direction: column;
            transition: opacity 0.5s;
        }
        #boot-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #boot-log {
            width: 80%;
            max-width: 600px;
            height: 300px;
            overflow: hidden;
        }
        #boot-log p {
            margin: 4px 0;
            white-space: pre;
        }
        #boot-log .ok { color: var(--accent-primary); }
        #boot-log .fail { color: var(--accent-secondary); }

        /* --- DESKTOP ENVIRONMENT --- */
        #desktop {
            width: 100%;
            height: 100%;
            position: relative;
            background-image:
                linear-gradient(rgba(0, 255, 156, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 156, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* --- TASKBAR / PANEL --- */
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: var(--panel);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 5000;
        }
        #taskbar-apps {
            display: flex;
            height: 100%;
            align-items: center;
        }
        #taskbar-apps .app-button {
            background: transparent;
            border: none;
            color: var(--muted-text);
            padding: 0 15px;
            height: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid transparent;
        }
        #taskbar-apps .app-button:hover {
            background: var(--glass);
        }
        #taskbar-apps .app-button.active {
            color: var(--accent-primary);
            border-bottom: 2px solid var(--accent-primary);
        }
        #system-tray {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #system-tray label {
            font-size: 12px;
        }
        #clock {
            color: var(--muted-text);
        }
        #scale-slider {
            width: 80px;
        }

        /* --- DESKTOP ICONS --- */
        #desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 80px;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .desktop-icon:hover, .desktop-icon:focus {
            background: rgba(0, 255, 156, 0.1);
            border: 1px solid var(--border-color);
            outline: none;
        }
        .desktop-icon svg {
            width: 32px;
            height: 32px;
            color: var(--accent-primary);
        }
        .desktop-icon span {
            font-size: 12px;
            word-break: break-word;
        }
        
        /* --- WINDOWING SYSTEM --- */
        .window {
            position: absolute;
            background: var(--glass);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 8px;
            min-width: 250px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            resize: both;
            overflow: hidden; /* This helps contain content and resizers */
        }
        .window.active {
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--glow-color);
            z-index: 1000 !important; /* Ensure active window is always on top */
        }
        .title-bar {
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            cursor: move;
            flex-shrink: 0;
        }
        .title-bar-title {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .title-bar-title svg {
            width: 16px;
            height: 16px;
        }
        .window-controls button {
            background: none;
            border: none;
            color: var(--muted-text);
            width: 20px;
            height: 20px;
            font-size: 16px;
            padding: 0;
            line-height: 20px;
            text-align: center;
            border-radius: 50%;
        }
        .window-controls button:hover {
            color: var(--text-color);
            background: rgba(255, 255, 255, 0.2);
        }
        .window-controls .close-btn:hover { background: var(--accent-secondary); }

        .window-content {
            padding: 15px;
            flex-grow: 1;
            overflow: auto;
        }
        
        /* Resizers */
        .resizer {
            position: absolute;
            width: 10px;
            height: 10px;
            background: transparent;
            z-index: 10;
        }
        .resizer.top-left { top: -5px; left: -5px; cursor: nwse-resize; }
        .resizer.top-right { top: -5px; right: -5px; cursor: nesw-resize; }
        .resizer.bottom-left { bottom: -5px; left: -5px; cursor: nesw-resize; }
        .resizer.bottom-right { bottom: -5px; right: -5px; cursor: nwse-resize; }
        .resizer.top { top: -5px; left: 5px; right: 5px; height: 10px; cursor: ns-resize; }
        .resizer.bottom { bottom: -5px; left: 5px; right: 5px; height: 10px; cursor: ns-resize; }
        .resizer.left { top: 5px; bottom: 5px; left: -5px; width: 10px; cursor: ew-resize; }
        .resizer.right { top: 5px; bottom: 5px; right: -5px; width: 10px; cursor: ew-resize; }

        /* --- APP-SPECIFIC STYLES --- */
        /* Terminal */
        .terminal-content {
            padding: 5px;
            background: #050505;
            height: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        #terminal-output {
            flex-grow: 1;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        #terminal-output .command { color: var(--accent-primary); }
        #terminal-output .error { color: var(--accent-secondary); }
        #terminal-output table { width: 100%; border-collapse: collapse; }
        #terminal-output th { text-align: left; color: var(--accent-primary); padding-right: 20px;}
        #terminal-input-line { display: flex; }
        #terminal-prompt { color: var(--accent-primary); }
        #terminal-input {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-family: inherit;
            flex-grow: 1;
        }
        #terminal-input:focus { outline: none; }

        /* Generic App Content */
        .app-content h1, .app-content h2 {
            color: var(--accent-primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        .app-content a {
            color: var(--accent-primary);
            text-decoration: none;
        }
        .app-content a:hover {
            text-decoration: underline;
        }
        .app-content ul { list-style: none; padding-left: 0; }
        .app-content li::before {
            content: "» ";
            color: var(--accent-primary);
        }

        /* Project Viewer */
        .project-viewer .tech-stack { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .project-viewer .tech-stack span { background: var(--panel); padding: 5px 10px; border-radius: 4px; font-size: 12px; }

        /* Contact Form */
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px;
            font-family: inherit;
        }
        #contact-form input:focus, #contact-form textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 8px var(--glow-color);
        }
        #form-status { font-style: italic; color: var(--muted-text); }
        #form-status.success { color: var(--accent-primary); }
        #form-status.error { color: var(--accent-secondary); }

        /* --- NO SCRIPT FALLBACK --- */
        #noscript-fallback {
            padding: 40px;
            background: #0A0A0A;
            color: #EFEFEF;
            font-family: sans-serif;
            text-align: center;
        }
        #noscript-fallback h1 { color: #00FF9C; }
        #noscript-fallback a { color: #00FF9C; }
    </style>
</head>
<body>

    <div id="boot-loader">
        <div id="boot-log"></div>
    </div>

    <div id="desktop">
        <div id="desktop-icons"></div>
    </div>

    <div id="taskbar">
        <div id="taskbar-apps"></div>
        <div id="system-tray">
            <label for="scale-slider">Scale</label>
            <input type="range" id="scale-slider" min="50" max="200" value="100">
            <div id="clock"></div>
        </div>
    </div>

    <template id="window-template">
        <div class="window" tabindex="-1">
            <div class="title-bar">
                <span class="title-bar-title">
                    <svg><use></use></svg>
                    <span></span>
                </span>
                <div class="window-controls">
                    <button class="close-btn" aria-label="Close Window">×</button>
                </div>
            </div>
            <div class="window-content"></div>
            <div class="resizer top-left"></div>
            <div class="resizer top-right"></div>
            <div class="resizer bottom-left"></div>
            <div class="resizer bottom-right"></div>
            <div class="resizer top"></div>
            <div class="resizer bottom"></div>
            <div class="resizer left"></div>
            <div class="resizer right"></div>
        </div>
    </template>
    
    <noscript>
        <div id="noscript-fallback">
            <h1>Moad Alouane — Cybersecurity Portfolio</h1>
            <p>This website requires JavaScript to run the interactive desktop experience.</p>
            <p>Please enable JavaScript or view the content below.</p>
            <hr>
            <h2>About Me</h2>
            <p>Game Developer & Cybersecurity Student.</p>
            <h2>Projects</h2>
            <ul>
                <li>University Life Simulation</li>
                <li>Cybersecurity Explorer</li>
                <li>Innovation Research</li>
            </ul>
            <p><a href="mailto:your-email@example.com">Contact Me</a></p>
        </div>
    </noscript>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ==================================================================
        // === CONFIGURATION OBJECT                                       ===
        // ==================================================================
        const CONFIG = {
            name: "Moad Alouane",
            title: "Game Developer & Cybersecurity Student",
            socials: {
                github: "https://github.com/your-github",
                linkedin: "https://linkedin.com/in/your-linkedin"
            },
            contactEndpoint: "", // Optional: Your Formspree or other contact form endpoint
            apps: [
                {
                    id: "about",
                    title: "About Me",
                    icon: "icon-user",
                    content: `
                        <div class="app-content">
                            <h1>Moad Alouane</h1>
                            <h2>Game Developer & Cybersecurity Student</h2>
                            <p>Welcome to my interactive desktop portfolio. I'm passionate about creating immersive digital experiences and securing them.</p>
                            <p>This portfolio itself is a project, designed to feel like a security operations console. Feel free to explore my projects, view my resume, or get in touch.</p>
                            <h3>Skills</h3>
                            <ul>
                                <li><strong>Languages:</strong> C++, Python, JavaScript, C#</li>
                                <li><strong>Tools:</strong> Unity, Unreal Engine, Wireshark, Metasploit, Git</li>
                                <li><strong>Concepts:</strong> Network Security, Game Design, Penetration Testing, OOP</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: "resume",
                    title: "Resume",
                    icon: "icon-document",
                    content: `
                        <div class="app-content">
                            <h1>Resume/CV</h1>
                            <p>A formal copy of my resume is available for download.</p>
                            <button onclick="alert('Download functionality would be implemented here.')">Download PDF</button>
                            <hr>
                            <h2>Experience</h2>
                            <h3>Cybersecurity Intern | SecureOrg Inc | Summer 2024</h3>
                            <ul>
                                <li>Assisted in vulnerability assessments and penetration testing.</li>
                                <li>Monitored network traffic for suspicious activity.</li>
                                <li>Contributed to security awareness training materials.</li>
                            </ul>
                            <h2>Education</h2>
                            <h3>B.S. in Computer Science | Tech University | 2021 - 2025</h3>
                            <ul>
                                <li>Concentration in Cybersecurity & Game Development.</li>
                                <li>GPA: 3.8/4.0</li>
                            </ul>
                        </div>
                    `
                },
                {
                    id: "contact",
                    title: "Secure Message",
                    icon: "icon-mail",
                    content: `
                        <div class="app-content">
                            <h1>Contact Me</h1>
                            <p>Send a secure message. I'll get back to you as soon as possible.</p>
                            <form id="contact-form">
                                <input type="text" name="name" placeholder="Name / Alias" required>
                                <input type="email" name="email" placeholder="Email" required>
                                <textarea name="message" rows="5" placeholder="Your message..." required></textarea>
                                <button type="submit">Encrypt & Send</button>
                            </form>
                            <p id="form-status"></p>
                        </div>
                    `
                },
                {
                    id: 'terminal',
                    title: 'Secure Terminal',
                    icon: 'icon-terminal',
                    content: `
                        <div class="terminal-content window-content">
                            <div id="terminal-output"></div>
                            <div id="terminal-input-line">
                                <span id="terminal-prompt">guest@ma-portfolio:~$ </span>
                                <input type="text" id="terminal-input" autofocus>
                            </div>
                        </div>
                    `
                },
                {
                    id: 'settings',
                    title: 'Settings',
                    icon: 'icon-settings',
                    content: `
                        <div class="app-content">
                            <h1>Settings</h1>
                            <h2>Display & Accessibility</h2>
                            <button id="reset-layout-btn">Reset Window Layout</button>
                            <p><em>Global display scale is controlled from the slider in the system tray.</em></p>
                        </div>
                    `
                },
            ],
            projects: [
                {
                    id: "university-life",
                    title: "University Life Sim",
                    icon: "icon-folder",
                    content: `
                        <div class="app-content project-viewer">
                            <h1>University Life Simulation</h1>
                            <p>A 2D simulation game developed in Unity where players navigate the challenges and opportunities of university life.</p>
                            <h3>Role: Lead Developer</h3>
                            <div class="tech-stack">
                                <span>C#</span><span>Unity Engine</span><span>Pixel Art</span>
                            </div>
                            <button onclick="alert('Live demo would be embedded or linked here.')">Launch Demo</button>
                        </div>
                    `
                },
                {
                    id: "cyber-explorer",
                    title: "Cybersecurity Explorer",
                    icon: "icon-folder",
                    content: `
                        <div class="app-content project-viewer">
                            <h1>Cybersecurity Explorer</h1>
                            <p>An interactive case study application that visualizes common network attacks and defense mechanisms.</p>
                            <h3>Role: Security Researcher & Developer</h3>
                             <div class="tech-stack">
                                <span>Python</span><span>JavaScript</span><span>Wireshark</span><span>Scapy</span>
                            </div>
                            <button onclick="window.open('${this.socials?.github || '#'}', '_blank')">View on GitHub</button>
                        </div>
                    `
                },
                {
                    id: "innovation-research",
                    title: "Innovation Research",
                    icon: "icon-folder",
                    content: `
                        <div class="app-content project-viewer">
                            <h1>Innovation Research Project</h1>
                            <p>Research into procedural content generation algorithms for creating realistic and diverse game worlds.</p>
                            <h3>Role: Researcher</h3>
                             <div class="tech-stack">
                                <span>C++</span><span>Algorithm Design</span><span>Data Structures</span>
                            </div>
                            <button onclick="alert('Research paper PDF would be linked here.')">Download Paper</button>
                        </div>
                    `
                },
            ]
        };
        // ==================================================================
        
        const desktop = document.getElementById('desktop');
        const desktopIcons = document.getElementById('desktop-icons');
        const taskbarApps = document.getElementById('taskbar-apps');
        const windowTemplate = document.getElementById('window-template');

        let openWindows = {};
        let activeWindow = null;
        let highestZIndex = 100;

        class WindowManager {
            constructor(app) {
                this.app = app;
                this.id = app.id;
                this.el = this.createWindowElement();
                
                this.setupEventListeners();
                this.focus();
                this.loadState();
            }

            createWindowElement() {
                const windowEl = windowTemplate.content.cloneNode(true).firstElementChild;
                windowEl.dataset.appId = this.id;
                
                const titleEl = windowEl.querySelector('.title-bar-title span');
                const iconEl = windowEl.querySelector('.title-bar-title svg use');
                const contentEl = windowEl.querySelector('.window-content');

                titleEl.textContent = this.app.title;
                iconEl.setAttribute('xlink:href', `#${this.app.icon}`);
                
                // If content is a string, set innerHTML. If it's a node, append it.
                if (typeof this.app.content === 'string') {
                    contentEl.innerHTML = this.app.content;
                } else {
                    contentEl.appendChild(this.app.content);
                }
                
                desktop.appendChild(windowEl);
                return windowEl;
            }

            setupEventListeners() {
                this.el.addEventListener('mousedown', () => this.focus(), true);
                this.el.querySelector('.close-btn').addEventListener('click', () => this.close());
                
                // Dragging
                const titleBar = this.el.querySelector('.title-bar');
                titleBar.addEventListener('mousedown', (e) => this.startDrag(e));

                // Resizing
                this.el.querySelectorAll('.resizer').forEach(resizer => {
                    resizer.addEventListener('mousedown', (e) => this.startResize(e));
                });
            }

            focus() {
                if (activeWindow === this) return;

                if (activeWindow) {
                    activeWindow.el.classList.remove('active');
                }
                document.querySelectorAll('.app-button.active').forEach(b => b.classList.remove('active'));

                this.el.style.zIndex = ++highestZIndex;
                this.el.classList.add('active');
                
                const taskbarButton = document.querySelector(`.app-button[data-app-id="${this.id}"]`);
                if(taskbarButton) taskbarButton.classList.add('active');

                activeWindow = this;
            }

            close() {
                desktop.removeChild(this.el);
                delete openWindows[this.id];
                const taskbarButton = document.querySelector(`.app-button[data-app-id="${this.id}"]`);
                if (taskbarButton) taskbarApps.removeChild(taskbarButton);
                if (activeWindow === this) activeWindow = null;
                this.saveState(); // Save "null" state to remove it
            }

            startDrag(e) {
                if (e.target.closest('.window-controls button')) return;
                e.preventDefault();
                this.focus();

                this.offsetX = e.clientX - this.el.offsetLeft;
                this.offsetY = e.clientY - this.el.offsetTop;

                const onMouseMove = (e) => {
                    this.el.style.left = `${e.clientX - this.offsetX}px`;
                    this.el.style.top = `${e.clientY - this.offsetY}px`;
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    this.saveState();
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }
            
            startResize(e) {
                e.preventDefault();
                this.focus();

                const resizer = e.target;
                const rect = this.el.getBoundingClientRect();
                const startX = e.clientX;
                const startY = e.clientY;
                const startWidth = rect.width;
                const startHeight = rect.height;
                const startLeft = this.el.offsetLeft;
                const startTop = this.el.offsetTop;

                const onMouseMove = (e) => {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;

                    if (resizer.classList.contains('right') || resizer.classList.contains('top-right') || resizer.classList.contains('bottom-right')) {
                        this.el.style.width = `${startWidth + dx}px`;
                    }
                    if (resizer.classList.contains('bottom') || resizer.classList.contains('bottom-left') || resizer.classList.contains('bottom-right')) {
                        this.el.style.height = `${startHeight + dy}px`;
                    }
                    if (resizer.classList.contains('left') || resizer.classList.contains('top-left') || resizer.classList.contains('bottom-left')) {
                        this.el.style.width = `${startWidth - dx}px`;
                        this.el.style.left = `${startLeft + dx}px`;
                    }
                    if (resizer.classList.contains('top') || resizer.classList.contains('top-left') || resizer.classList.contains('top-right')) {
                        this.el.style.height = `${startHeight - dy}px`;
                        this.el.style.top = `${startTop + dy}px`;
                    }
                };
                
                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    this.saveState();
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }

            saveState() {
                const states = JSON.parse(localStorage.getItem('windowStates') || '{}');
                if (!desktop.contains(this.el)) {
                     delete states[this.id];
                } else {
                    states[this.id] = {
                        left: this.el.style.left,
                        top: this.el.style.top,
                        width: this.el.style.width,
                        height: this.el.style.height,
                        zIndex: this.el.style.zIndex
                    };
                }
                localStorage.setItem('windowStates', JSON.stringify(states));
            }

            loadState() {
                const states = JSON.parse(localStorage.getItem('windowStates') || '{}');
                const state = states[this.id];
                if (state) {
                    this.el.style.left = state.left;
                    this.el.style.top = state.top;
                    this.el.style.width = state.width;
                    this.el.style.height = state.height;
                    this.el.style.zIndex = state.zIndex;
                    if (parseInt(state.zIndex) > highestZIndex) {
                        highestZIndex = parseInt(state.zIndex);
                    }
                } else {
                    // Default position
                    const offset = Object.keys(openWindows).length * 20;
                    this.el.style.left = `${100 + offset}px`;
                    this.el.style.top = `${50 + offset}px`;
                    this.el.style.width = '600px';
                    this.el.style.height = '400px';
                }
            }
        }

        function openApp(appId) {
            const app = [...CONFIG.apps, ...CONFIG.projects].find(a => a.id === appId);
            if (!app) return;
            
            if (openWindows[appId]) {
                openWindows[appId].focus();
            } else {
                openWindows[appId] = new WindowManager(app);
                createTaskbarButton(app);
            }

            // If app has special init logic (like Terminal), run it.
            if(app.onOpen) app.onOpen();
        }

        function createDesktopIcon(app) {
            const icon = document.createElement('div');
            icon.className = 'desktop-icon';
            icon.tabIndex = 0;
            icon.innerHTML = `
                <svg><use xlink:href="#${app.icon}"></use></svg>
                <span>${app.title}</span>
            `;
            icon.addEventListener('click', () => openApp(app.id));
            icon.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') openApp(app.id);
            });
            desktopIcons.appendChild(icon);
        }
        
        function createTaskbarButton(app) {
             const button = document.createElement('button');
             button.className = 'app-button';
             button.dataset.appId = app.id;
             button.innerHTML = `
                <svg width="16" height="16"><use xlink:href="#${app.icon}"></use></svg>
                <span>${app.title}</span>`;
             button.addEventListener('click', () => openApp(app.id));
             taskbarApps.appendChild(button);
        }

        // --- Terminal Logic ---
        function initTerminal() {
            const terminalWindow = document.querySelector('[data-app-id="terminal"]');
            if (!terminalWindow) return;

            const output = terminalWindow.querySelector('#terminal-output');
            const input = terminalWindow.querySelector('#terminal-input');
            const welcomeMessage = `Secure Shell v1.0\nType 'help' for a list of available commands.\n`;
            output.innerHTML += welcomeMessage;
            
            const commandHistory = [];
            let historyIndex = -1;

            const commands = {
                help: () => `Available commands:\n` +
                           `<table>` +
                           `<tr><th>help</th><td>Show this help message</td></tr>` +
                           `<tr><th>ls</th><td>List projects and apps</td></tr>` +
                           `<tr><th>open [id]</th><td>Open an app or project (e.g., 'open resume')</td></tr>` +
                           `<tr><th>cat [id]</th><td>Display content of a file/app</td></tr>` +
                           `<tr><th>socials</th><td>Display social media links</td></tr>` +
                           `<tr><th>contact</th><td>Open the contact form</td></tr>` +
                           `<tr><th>clear</th><td>Clear the terminal screen</td></tr>` +
                           `</table>`,
                ls: () => {
                    const allApps = [...CONFIG.apps, ...CONFIG.projects];
                    return allApps.map(a => `<span style="color:var(--accent-primary)">${a.id}</span>`).join('\n');
                },
                open: (args) => {
                    const appId = args[0];
                    if (!appId) return `<span class="error">Error: 'open' requires an argument. Try 'ls' to see available items.</span>`;
                    const app = [...CONFIG.apps, ...CONFIG.projects].find(a => a.id === appId);
                    if (app) {
                        openApp(appId);
                        return `Opening ${appId}...`;
                    }
                    return `<span class="error">Error: File not found: ${appId}</span>`;
                },
                cat: (args) => {
                    const appId = args[0];
                    if (!appId) return `<span class="error">Error: 'cat' requires an argument.</span>`;
                    const app = [...CONFIG.apps, ...CONFIG.projects].find(a => a.id === appId);
                    if (app) {
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = app.content;
                        return `--- BEGIN ${app.id} ---\n${tempDiv.textContent || tempDiv.innerText}\n--- END ${app.id} ---`;
                    }
                     return `<span class="error">Error: File not found: ${appId}</span>`;
                },
                socials: () => `GitHub: <a href="${CONFIG.socials.github}" target="_blank">${CONFIG.socials.github}</a>\nLinkedIn: <a href="${CONFIG.socials.linkedin}" target="_blank">${CONFIG.socials.linkedin}</a>`,
                contact: () => commands.open(['contact']),
                clear: () => { output.innerHTML = ''; return ''; }
            };

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && input.value) {
                    const commandStr = input.value;
                    const [command, ...args] = commandStr.split(' ');
                    output.innerHTML += `<span class="command">guest@ma-portfolio:~$ ${commandStr}</span>\n`;
                    
                    if (commands[command]) {
                        const result = commands[command](args);
                        if(result) output.innerHTML += result + '\n';
                    } else {
                        output.innerHTML += `<span class="error">Command not found: ${command}</span>\n`;
                    }
                    
                    commandHistory.unshift(commandStr);
                    historyIndex = -1;
                    input.value = '';
                    output.scrollTop = output.scrollHeight;
                } else if (e.key === 'ArrowUp') {
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        input.value = commandHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    if (historyIndex > 0) {
                        historyIndex--;
                        input.value = commandHistory[historyIndex];
                    } else {
                        historyIndex = -1;
                        input.value = '';
                    }
                }
            });
        }
        
        // Add a hook to initialize terminal when opened
        const terminalAppConfig = CONFIG.apps.find(a => a.id === 'terminal');
        if (terminalAppConfig) terminalAppConfig.onOpen = initTerminal;
        
        // --- Contact Form Logic ---
        function initContactForm() {
            const form = document.getElementById('contact-form');
            if(!form) return;
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const status = document.getElementById('form-status');
                status.textContent = 'Encrypting and sending...';
                status.className = '';

                // Simulate submission
                setTimeout(() => {
                    status.textContent = 'Message sent successfully! Stored local log.';
                    status.className = 'success';
                    form.reset();
                }, 1500);

                // Real submission logic (if endpoint is provided)
                /*
                if(CONFIG.contactEndpoint) {
                    const formData = new FormData(form);
                    fetch(CONFIG.contactEndpoint, {
                        method: 'POST',
                        body: formData,
                        headers: { 'Accept': 'application/json' }
                    }).then(response => {
                        if (response.ok) {
                             status.textContent = 'Message sent successfully!';
                             status.className = 'success';
                             form.reset();
                        } else {
                            throw new Error('Network response was not ok.');
                        }
                    }).catch(error => {
                        status.textContent = 'Error: Could not send message.';
                        status.className = 'error';
                    });
                }
                */
            });
        }
        const contactAppConfig = CONFIG.apps.find(a => a.id === 'contact');
        if (contactAppConfig) contactAppConfig.onOpen = initContactForm;


        // --- System Initialization ---
        function initClock() {
            const clockEl = document.getElementById('clock');
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                clockEl.textContent = `${hours}:${minutes}`;
            }
            updateClock();
            setInterval(updateClock, 1000);
        }
        
        function initScaling() {
            const slider = document.getElementById('scale-slider');
            const savedScale = localStorage.getItem('globalScale') || 100;
            
            function applyScale(value) {
                const scaleValue = value / 100;
                document.body.style.setProperty('--global-scale', scaleValue);
                // Using transform on the body can be tricky. A container div might be better.
                // For simplicity, we'll let CSS variables handle font/spacing if possible,
                // but this demonstrates the control.
                document.body.classList.add('scaled');
                localStorage.setItem('globalScale', value);
            }
            
            slider.value = savedScale;
            applyScale(savedScale);

            slider.addEventListener('input', () => applyScale(slider.value));
        }

        function initSettingsApp() {
             const resetButton = document.getElementById('reset-layout-btn');
             if(!resetButton) return;
             resetButton.addEventListener('click', () => {
                if(confirm('Are you sure you want to reset all window positions?')) {
                    localStorage.removeItem('windowStates');
                    alert('Layout has been reset. Please refresh the page.');
                }
             });
        }
        const settingsAppConfig = CONFIG.apps.find(a => a.id === 'settings');
        if (settingsAppConfig) settingsAppConfig.onOpen = initSettingsApp;
        
        function loadPersistedWindows() {
             const states = JSON.parse(localStorage.getItem('windowStates') || '{}');
             for (const appId in states) {
                if (states[appId]) {
                    openApp(appId);
                }
             }
        }
        
        // --- BOOT SEQUENCE ---
        function runBootSequence() {
            const loader = document.getElementById('boot-loader');
            const log = document.getElementById('boot-log');
            const steps = [
                "Initializing Kernel...",
                "Loading drivers... <span class='ok'>[OK]</span>",
                "Mounting virtual filesystem... <span class='ok'>[OK]</span>",
                "Starting window manager... <span class='ok'>[OK]</span>",
                "Establishing secure connection... <span class='ok'>[OK]</span>",
                "Loading user profile: Moad Alouane... <span class='ok'>[OK]</span>",
                "Boot sequence complete. Welcome."
            ];

            let i = 0;
            function nextStep() {
                if (i < steps.length) {
                    log.innerHTML += `<p>${steps[i]}</p>`;
                    log.scrollTop = log.scrollHeight;
                    i++;
                    setTimeout(nextStep, Math.random() * 200 + 50);
                } else {
                    setTimeout(() => {
                        loader.classList.add('hidden');
                    }, 500);
                }
            }
            nextStep();
        }

        function init() {
            runBootSequence();

            [...CONFIG.apps, ...CONFIG.projects].forEach(createDesktopIcon);
            initClock();
            initScaling();
            loadPersistedWindows();
            
            // Default open apps on first visit
            if (!localStorage.getItem('windowStates')) {
                 openApp('about');
            }
        }

        init();
    });
    </script>
</body>
</html>