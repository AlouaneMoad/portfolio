<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moad• Cybersecurity Portfolio</title>
<link rel="icon" href="avatar.png" type="image/x-icon"/>
<link rel="shortcut icon" href="avatar.png" type="image/x-icon"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Added for Media Player -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  /* Media Player Custom Styles */
  #volume-fill {
      transition: height 0.1s ease;
  }
  #media-player-widget {
      font-family: 'Inter', sans-serif;
      cursor: auto; /* Override the body's cursor:none from main styles */
  }
</style>
<!-- End Media Player additions -->

<style>
  :root{
    --bg0:#0f172a; 
    --bg1:#020617; 
    --panel:#1e293b; 
    --edge:#334155;
    --accent:#00b3ff; 
    --accent2:#0284c7; 
    --text:#f8fafc; 
    --muted:#cbd5e1; 
    --shadow:rgba(0,0,0,.6);
    --grid:#334155; 
  }
  html,body{height:100%}
  *{box-sizing:border-box}
  body{
    margin:0;
    overflow:hidden;
    color:var(--text);
    cursor:none;
    font-family:"JetBrains Mono",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    background-image: url('background.png');
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    background-color: var(--bg1); 
  }
  

  .desktop{position:relative;z-index:2;height:100vh;width:100vw}
  .icons{position:absolute;inset:0 0 42px 0;padding:56px 16px 90px 16px}
  .icon{position:absolute;width:96px;text-align:center;border:0;background:transparent;color:inherit;user-select:none}
  .icon .glyph{
    width:72px;
    height:72px;
    margin:0 auto 6px;
    display:grid;
    place-items:center;
    border:1px solid var(--edge); 
    border-radius:14px;
    background:#1e293ba8; 
    box-shadow:0 12px 22px var(--shadow),inset 0 0 0 1px var(--bg0); 
  }
  .icon .glyph svg{width:40px;height:40px;fill:var(--accent)}
  .icon .label{font-size:19px;color:#ffffff;text-shadow:0 1px 0 #000} 
  .icon:focus-visible .glyph{outline:2px solid var(--accent);outline-offset:3px}
  
  .win{
    position:absolute;
    min-width:260px;
    min-height:170px;
    max-width:96vw;
    max-height:84vh;
    background:linear-gradient(180deg, #1e293be0 0%, #0f172ae0 100%); 
    border:1px solid var(--edge); 
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 26px 60px rgba(0,0,0,.6),0 1px 0 #334155 inset; 
    transform:translate3d(0,0,0);
    transition:box-shadow .25s ease,transform .22s ease,opacity .18s ease
  }
  .win.hidden{opacity:0;transform:translate3d(0,-12px,0) scale(.98);pointer-events:none}
  .win.min{opacity:0;transform:translate3d(0,6px,0) scale(.98);pointer-events:none}
  
  .head{
    height:42px;
    display:flex;
    align-items:center;
    gap:10px;
    padding:0 10px;
    border-bottom:1px solid #475569; 
    background:linear-gradient(180deg, #334155 0%, #1e293b 100%); 
    cursor:grab;
    user-select:none
  }
  .head:active{cursor:grabbing}
  .controls{display:flex;gap:6px}
  .btn{
    width:24px;
    height:24px;
    border-radius:7px;
    background:#0f172a; 
    border:1px solid #475569; 
    color:#e2e8f0;
    font-weight:700;
    line-height:18px;
    display:grid;
    place-items:center;
    box-shadow:0 0 0 1px #020617 inset; 
  }
  .btn:hover{filter:brightness(1.06)}
  .btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .btn.close{
    background:#0f172a; 
    border-color:#38bdf8; 
    color:#e0f2fe; 
  }
  .titlebar{
    color:#f1f5f9; 
    font-weight:700;
    letter-spacing:.03em;
    flex:1;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap
  }
  .body{padding:12px;height:calc(100% - 42px);overflow:auto}
  .resize-h{position:absolute}
  .r-n{top:-4px;left:8px;right:8px;height:8px;cursor:n-resize}
  .r-s{bottom:-4px;left:8px;right:8px;height:8px;cursor:s-resize}
  .r-e{top:8px;right:-4px;bottom:8px;width:8px;cursor:e-resize}
  .r-w{top:8px;left:-4px;bottom:8px;width:8px;cursor:w-resize}
  .r-ne{top:-4px;right:-4px;width:10px;height:10px;cursor:ne-resize}
  .r-nw{top:-4px;left:-4px;width:10px;height:10px;cursor:nw-resize}
  .r-se{bottom:-4px;right:-4px;width:10px;height:10px;cursor:se-resize}
  .r-sw{bottom:-4px;left:-4px;width:10px;height:10px;cursor:sw-resize}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{
    border:1px solid #334155; 
    background:#0f172a; 
    border-radius:999px;
    padding:6px 10px;
    color:#e2e8f0; 
    text-decoration:none
  }
  .list{padding-left:18px;line-height:1.6;color:var(--muted)}
  .project{
    border:1px solid #334155; 
    border-radius:12px;
    padding:10px;
    background:#0f172a; 
    margin-bottom:10px
  }
  .ctx{
    position:fixed;
    z-index:20;
    min-width:200px;
    border:1px solid #475569; 
    border-radius:10px;
    overflow:hidden;
    background:linear-gradient(180deg, #1e293b 0%, #0f172a 100%); 
    box-shadow:0 12px 36px rgba(0,0,0,.55);
    display:none
  }
  .ctx button{display:block;width:100%;background:transparent;color:var(--text);text-align:left;padding:10px 12px;border:0;font-family:inherit;font-size:13px}
  .ctx button:hover,.ctx button:focus{
    background:#334155; 
    outline:2px solid #0ea5e933 
  }
  .cursor{position:fixed;z-index:40;width:18px;height:18px;pointer-events:none;mix-blend-mode:screen;transform:translate(-50%,-50%)}
  .cursor::before{content:"";position:absolute;inset:0;border:1px solid var(--accent);border-radius:50%;box-shadow:0 0 8px var(--accent2)}
  .cursor::after{content:"";position:absolute;left:50%;top:50%;width:12px;height:12px;transform:translate(-50%,-50%);background:radial-gradient(circle,var(--accent) 0 1px,transparent 2px);box-shadow:0 0 8px var(--accent2)}
  button:focus-visible,.icon:focus-visible,.win:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .taskbar{
    position:fixed;
    left:8px;
    right:8px;
    bottom:8px;
    height:40px;
    z-index:30;
    display:flex;
    align-items:center;
    gap:8px;
    padding:6px 8px;
    border-radius:12px;
    background:linear-gradient(180deg, #1e293b 0%, #0f172a 100%); 
    border:1px solid var(--edge);
    box-shadow:0 14px 38px rgba(0,0,0,.5)
  }
  .start-btn{
    background:#0f172a; 
    border:1px solid #475569; 
    color:#e2e8f0; 
    border-radius:10px;
    padding:8px 12px;
    font-weight:700
  }
  .tasks{display:flex;gap:6px;flex:1;overflow:auto}
  .task{
    background:#0f172a; 
    border:1px solid #334155; 
    color:#e2e8f0; 
    border-radius:8px;
    padding:6px 10px;
    white-space:nowrap;
    max-width:180px;
    overflow:hidden;
    text-overflow:ellipsis
  }
  .clock{color:var(--muted);font-variant-numeric:tabular-nums;padding:0 6px}
  .start{
    position:fixed;
    left:8px;
    bottom:56px;
    width:260px;
    z-index:35;
    border:1px solid var(--edge);
    border-radius:12px;
    background:linear-gradient(180deg, #1e293b 0%, #0f172a 100%); 
    box-shadow:0 18px 44px rgba(0,0,0,.6);
    display:none
  }
  .start.visible{display:block}
  .start h4{margin:10px 12px 6px 12px}
  .start .menu{display:grid;gap:6px;padding:6px 8px}
  .start .menu button{
    background:#0f172a; 
    border:1px solid #334155; 
    color:#e2e8f0; 
    border-radius:8px;
    padding:8px 10px;
    text-align:left
  }
  .emblem{position:fixed;left:14px;top:12px;z-index:3;opacity:.8;user-select:none;pointer-events:none}
  .emblem b{color:var(--accent)}
  @media (max-width:680px){.icon{width:82px}.icon .glyph{width:64px;height:64px}.icon .label{font-size:11px}.win{max-width:96vw;max-height:78vh}}

  #dlResume {
    background: var(--accent);
    color: var(--bg1);
    font-weight: 700;
    border-color: var(--accent2);
  }
  pre[style*='background:#23170f'] {
    background: #0f172a !important; 
    border-color: #334155 !important; 
    color: #e2e8f0 !important; 
  }
  textarea[style*='background:#22160f'] {
    background: #0f172a !important; 
    border-color: #334155 !important; 
    color: #e2e8f0 !important; /
  }
</style>
</head>
<body>

  <audio id="audio-player"></audio>
  <div id="media-player-widget" class="fixed top-4 right-4 z-[38] w-full max-w-sm bg-gray-900 text-white rounded-xl shadow-2xl p-4 flex space-x-4 overflow-hidden">
      
      <div class="flex flex-col items-center justify-center space-y-2">
          <div id="volume-track" class="w-2 h-32 bg-gray-700 rounded-full relative cursor-pointer">
              <div id="volume-fill" class="w-full bg-blue-500 rounded-full absolute bottom-0" style="height: 24%;"></div>
          </div>
          <span id="volume-number" class="text-xs text-gray-400 font-medium">24</span>
      </div>

      <div class="flex flex-col flex-grow space-y-3 min-w-0">
          
          <div class="flex items-center space-x-3">
              <img 
                  src="avatar.png" 
                  onerror="this.src='https://placehold.co/80x80/1a202c/ffffff?text=ART'"
                  alt="Album Art"
                  class="w-20 h-20 rounded-md object-cover shadow-md flex-shrink-0"
              >
              <div class="flex-grow min-w-0">
                  <h2 class="text-lg font-bold text-white truncate" title="Awake The Science (truncated)">Music</h2>
                  <p class="text-sm text-gray-300">Moad Alouane</p>
              </div>
          </div>

          <div class="flex justify-center items-center space-x-8 pt-2">
              <button id="prev-btn" class="text-gray-400 hover:text-white transition-colors duration-200 text-2xl" aria-label="Previous Track">
                  ⏮️
              </button>
              
              <button id="play-pause-btn" class="text-white hover:text-gray-200 transition-colors duration-200 text-4xl" aria-label="Play Track">
                  ▶️
              </button>
              
              <button id="next-btn" class="text-gray-400 hover:text-white transition-colors duration-200 text-2xl" aria-label="Next Track">
                  ⏭️
              </button>
          </div>
      </div>
  </div>
  <!-- End Media Player Widget -->

  <div class="desktop" id="desktop" tabindex="-1" aria-label="Desktop">
    <div class="icons" id="icons"></div>
  </div>
  <div class="taskbar" id="taskbar">
    <button class="start-btn" id="startBtn">● Start</button>
    <div class="tasks" id="tasks"></div>
    <div class="clock" id="clock"></div>
  </div>
  <div class="start" id="startMenu">
    <h4 style="margin-top:10px">Quick Actions</h4>
    <div class="menu">
      <button data-act="open-about">About</button>
      <button data-act="arrange">Arrange Icons</button>
      <button data-act="reset-layout">Reset Layout</button>
      <button data-act="closeall">Close All Windows</button>
      <button data-act="quite">turn off</button>

    </div>
  </div>
  <div class="ctx" id="ctxMenu" role="menu" aria-hidden="true">
    <button type="button" data-action="arrange">Arrange Icons</button>
    <button type="button" data-action="closeall">Close All Windows</button>
  </div>
  <div class="emblem" aria-hidden="true"><b>MOAD</b> • Portfolio</div>
  <div class="cursor" id="cursor" aria-hidden="true"></div>
  
  <script>
  (()=>{
    "use strict";
    const $=(s,e=document)=>e.querySelector(s);const $$=(s,e=document)=>[...e.querySelectorAll(s)];const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));const lerp=(a,b,t)=>a+(b-a)*t;
    const store={get(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}},set(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch{}}};
    
    // --- Clock ---
    const clockEl=$('#clock');const tickClock=()=>{const d=new Date();const p=v=>String(v).padStart(2,'0');clockEl.textContent=`${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`};setInterval(tickClock,1000);tickClock();
    
    // --- Icons ---
    const iconsWrap=$('#icons');
    const ICONS=[
      {id:'about',label:'About Me',svg:`<svg viewBox='0 0 24 24'><path d='M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z'/></svg>`},
      {id:'projects',label:'Projects',svg:`<svg viewBox='0 0 24 24'><path d='M3 5h18v4H3V5zm0 5h18v9H3v-9zm2 2v5h6v-5H5zm8 0v5h6v-5h-6z'/></svg>`},
      {id:'skills',label:'Skills',svg:`<svg viewBox='0 0 24 24'><path d='M12 2l3 6 6 .9-4.5 4.3L17 20l-5-2.6L7 20l1.5-6.8L4 8.9 10 8l2-6z'/></svg>`},
      {id:'awards',label:'Awards',svg:`<svg viewBox='0 0 24 24'><path d='M17 3H7a2 2 0 0 0-2 2v14l7-3 7 3V5a2 2 0 0 0-2-2z'/></svg>`},
      {id:'resume',label:'Resume',svg:`<svg viewBox='0 0 24 24'><path d='M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V7h3.5L14 3.5zM7 9h10v2H7V9zm0 4h10v2H7v-2zm0 4h6v2H7v-2z'/></svg>`},
      {id:'contact',label:'Contact',svg:`<svg viewBox='0 0 24 24'><path d='M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z'/></svg>`},
    ];
    
    const saved=store.get('iconPositions_blue',{});
    function setIconPos(el,x,y){el.style.left=x+"px";el.style.top=y+"px"}
    function createIcon(meta,idx){const d=document.createElement('button');d.className='icon';d.type='button';d.id='icon-'+meta.id;d.setAttribute('aria-label',meta.label);d.innerHTML=`<div class="glyph">${meta.svg}</div><div class="label">${meta.label}</div>`;const col=Math.floor(idx%6),row=Math.floor(idx/6);const def={x:18+col*108,y:64+row*112};const pos=saved[meta.id]||def;setIconPos(d,pos.x,pos.y);let last=0;d.addEventListener('click',()=>{const now=Date.now();if(now-last<300){openWindow(meta.id);last=0}else last=now});d.addEventListener('dblclick',()=>openWindow(meta.id));d.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){openWindow(meta.id);e.preventDefault()}});makeDraggableIcon(d,meta.id);iconsWrap.appendChild(d)}
    ICONS.forEach(createIcon);
    function makeDraggableIcon(el,key){let sx=0,sy=0,ox=0,oy=0,drag=false;const down=e=>{const p=pointer(e);drag=true;sx=p.x;sy=p.y;const r=el.getBoundingClientRect();ox=r.left;oy=r.top;el.setPointerCapture?.(e.pointerId)};const move=e=>{if(!drag)return;const p=pointer(e);const nx=clamp(ox+(p.x-sx),4,innerWidth-el.offsetWidth-4);const ny=clamp(oy+(p.y-sy),56,innerHeight-el.offsetHeight-52);setIconPos(el,nx,ny)};const up=e=>{if(!drag)return;drag=false;el.releasePointerCapture?.(e.pointerId);storePositions()};el.addEventListener('pointerdown',down);addEventListener('pointermove',move);addEventListener('pointerup',up)}
    function storePositions(){const obj={};ICONS.forEach(m=>{const el=$('#icon-'+m.id);if(!el)return;obj[m.id]={x:parseFloat(el.style.left),y:parseFloat(el.style.top)}});
      store.set('iconPositions_blue',obj); 
    }
    const desktop=$('#desktop');let zTop=10;const windows=new Map();
    function templateFor(id){switch(id){
      case 'about':return{title:'About • Moad Alouane',w:520,h:340,content:`<div style="display:grid;gap:10px"><h3 style="margin:0;color:var(--text)">Hi, I'm <span style='color:var(--accent)'>Moad Alouane</span></h3><p style="margin:0;color:var(--muted)">Cybersecurity and Computer Science student at Southwest Petroleum University (Chengdu, China). Focused on blue-team operations, threat hunting, and security automation. Building hands-on experience via CTFs and a homelab.</p><div class="chips"><span class="chip">C++</span><span class="chip">Python</span><span class="chip">Bash</span><span class="chip">Linux</span><span class="chip">Nmap</span><span class="chip">Wireshark</span><span class="chip">Metasploit</span></div></div>`};
      case 'projects':return{title:'Projects',w:640,h:430,content:`<div class="project"><b>AI Gesture Control Suite</b> — Real-time hand tracking for cursor control, smart clicks/drag, and volume control.<br><small>Python, OpenCV, MediaPipe</small></div><div class="project"><b>University Life Simulation Game</b> — Low‑poly 3D simulation with stats, day/night, audio, and phone UI.<br><small>Unity 3D (C#)</small></div><div class="project"><b>Digital Balance Self‑Assessment Tool</b> — Bilingual web app for digital wellness with charts and PDF export.<br><small>HTML, CSS, JavaScript</small></div>`};
      case 'skills':return{title:'Skills',w:540,h:360,content:`<h4 style="margin:0 0 8px 0">Programming</h4><div class="chips"><span class="chip">C++</span><span class="chip">Python</span><span class="chip">Java</span><span class="chip">Bash</span></div><h4 style="margin:12px 0 8px 0">Security & Tools</h4><div class="chips"><span class="chip">Linux</span><span class="chip">Kali Linux</span><span class="chip">Nmap</span><span class="chip">Wireshark</span><span class="chip">Metasploit</span><span class="chip">Git</span><span class="chip">VirtualBox</span></div><h4 style="margin:12px 0 8px 0">Soft Skills</h4><div class="chips"><span class="chip">Problem‑solving</span><span class="chip">Teamwork</span><span class="chip">Communication</span><span class="chip">Self‑learning</span></div>`};
      case 'awards':return{title:'Awards & Certifications',w:560,h:400,content:`<h4 style='margin:0 0 6px 0'>Awards</h4><ul class="list"><li>First Prize — Chinese‑English Bilingual Recitation Championship (May 2025)</li><li>Third Prize — “Carelink” Project, International Entrepreneurship Contest (Dec 2024)</li></ul><h4 style='margin:8px 0 6px 0'>Certifications</h4><ul class="list"><li>IBM Cybersecurity Analyst Professional Certificate</li><li>Google Cybersecurity Professional Certificate</li><li>Cyber Security 101 — TryHackMe</li><li>Telstra AU — Cybersecurity Job Simulation (Forage)</li><li>Pre Security — TryHackMe</li></ul>`};
      case 'resume':return{title:'Resume (Plaintext)',w:600,h:460,content:`<button class='chip' id='dlResume'>Download Resume.txt</button><pre style='margin-top:12px;padding:10px;border:1px solid #334155;border-radius:10px;background:#0f172a;color:#e2e8f0;white-space:pre-wrap'>MOAD ALOUANE\nCybersecurity & Computer Science Student | CTF Enthusiast | Aspiring Security Analyst\nSouthwest Petroleum University, Chengdu, China\nEmail: alouanemoad@gmail.com | Phone: +86 19138477535 | LinkedIn: linkedin.com/in/alouanemoad\n\nPROFILE\nProactive third-year CS student with foundations in software development, IT ops, and cybersecurity. Skilled in C++, Python, Bash, Linux, and security tools (Nmap, Wireshark, Metasploit). Preparing for Network+ and Security+ while building hands-on experience via CTFs and homelab projects.\n\nPROJECTS\n• AI Gesture Control Suite — Real-time hand tracking to control cursor, perform smart clicks/drag, volume control. (Python, OpenCV, MediaPipe)\n• University Life Simulation Game — Low-poly 3D PC sim with stats, day/night cycle, audio, phone UI. (Unity 3D / C#)\n• Digital Balance Self-Assessment Tool — Bilingual web app with charts, PDF export, i18n. (HTML/CSS/JS)\n\nAWARDS\n• First Prize — Chinese-English Bilingual Recitation Championship (May 2025)\n• Third Prize — “Carelink” Project, International Entrepreneurship Contest (Dec 2024)\n\nCERTIFICATIONS\n• IBM Cybersecurity Analyst | • Google Cybersecurity | • THM Cyber Security 101 | • Telstra AU (Forage) | • THM Pre Security\n\nSKILLS\nProgramming: C++, Python, Java, Bash\nSecurity Tools: Nmap, Wireshark, Linux, Metasploit\nOther: Git, VirtualBox, Kali Linux\n\nLANGUAGES\nArabic (Native) | English (Highly Proficient) | French (Working) | Chinese (Basic)</pre>`};
      case 'contact':return{title:'Contact',w:500,h:300,content:`<div style='display:grid;gap:10px'><p style='margin:0;color:var(--muted)'>Open for internships, CTF teams, and security projects.</p><div class='chips'><a class='chip' href='mailto:alouanemoad@gmail.com'>alouanemoad@gmail.com</a><a class='chip' href='tel:+8619138477535'>+86 19138477535</a><a class 'chip' href='https://www.linkedin.com/in/alouanemoad' target='_blank' rel='noopener'>LinkedIn</a></div><label>Quick message (demo):<br/><textarea style='width:100%;height:120px;background:#0f172a;color:#e2e8f0;border:1px solid #334155;border-radius:8px;padding:8px;font-family:inherit' placeholder='Type here...'></textarea></label></div>`};
    }return{title:id,w:380,h:260,content:"<div>Unknown</div>"}
    }
    function openWindow(id){if(windows.has(id)){focusWindow(windows.get(id));return}const t=templateFor(id);const w=document.createElement('section');w.className='win hidden';w.id='win-'+id;w.tabIndex=0;w.setAttribute('role','dialog');w.style.left=(100+Math.random()*120)+'px';w.style.top=(84+Math.random()*80)+'px';w.style.width=t.w+'px';w.style.height=t.h+'px';w.innerHTML=`<div class="head" data-drag="1"><div class="controls"><button class="btn close" title="Close" aria-label="Close">×</button><button class="btn" data-min title="Minimize" aria-label="Minimize">—</button><button class="btn" data-max title="Maximize" aria-label="Maximize">▢</button></div><div class="titlebar">${t.title}</div></div><div class="body">${t.content}</div><div class="resize-h r-n"></div><div class="resize-h r-s"></div><div class="resize-h r-e"></div><div class="resize-h r-w"></div><div class="resize-h r-ne"></div><div class="resize-h r-nw"></div><div class="resize-h r-se"></div><div class="resize-h r-sw"></div>`;desktop.appendChild(w);requestAnimationFrame(()=>w.classList.remove('hidden'));const closeBtn=$('.btn.close',w);closeBtn.addEventListener('pointerdown',e=>{e.stopPropagation()});closeBtn.addEventListener('click',e=>{e.stopPropagation();closeWindow(id)});const minBtn=$('[data-min]',w);minBtn.addEventListener('pointerdown',e=>{e.stopPropagation()});minBtn.addEventListener('click',e=>{e.stopPropagation();toggleMin(w,id)});const maxBtn=$('[data-max]',w);maxBtn.addEventListener('pointerdown',e=>{e.stopPropagation()});maxBtn.addEventListener('click',e=>{e.stopPropagation();toggleMax(w)});$('.controls',w).addEventListener('pointerdown',e=>{e.stopPropagation()});makeDraggableWindow(w,$('.head',w));makeResizableWindow(w);w.addEventListener('mousedown',()=>focusWindow(w));w.addEventListener('touchstart',()=>focusWindow(w));w.addEventListener('keydown',e=>{if(e.key==='Escape'){closeWindow(id)}});if(id==='resume'){const btn=$('#dlResume',w);if(btn)btn.addEventListener('click',downloadResume)}
      windows.set(id,w);addTaskButton(id,t.title);focusWindow(w)}
    function focusWindow(w){zTop+=1;w.style.zIndex=zTop;w.focus({preventScroll:true})}
    function closeWindow(id){const w=windows.get(id);if(!w)return;w.classList.add('hidden');setTimeout(()=>{w.remove();windows.delete(id);removeTaskButton(id)},160)}
    let maximized=new WeakSet();function toggleMax(w){if(maximized.has(w)){w.style.left=w.dataset.oldLeft;w.style.top=w.dataset.oldTop;w.style.width=w.dataset.oldW;w.style.height=w.dataset.oldH;maximized.delete(w)}else{w.dataset.oldLeft=w.style.left;w.dataset.oldTop=w.style.top;w.dataset.oldW=w.style.width;w.dataset.oldH=w.style.height;w.style.left='10px';w.style.top='10px';w.style.width=(innerWidth-20)+'px';w.style.height=(innerHeight-60)+'px';maximized.add(w)}}
    function makeDraggableWindow(win,handle){let sx=0,sy=0,ox=0,oy=0,drag=false;const down=e=>{if(e.button===2)return;if(e.target.closest('.controls'))return;drag=true;const p=pointer(e);sx=p.x;sy=p.y;const r=win.getBoundingClientRect();ox=r.left;oy=r.top;handle.setPointerCapture?.(e.pointerId);focusWindow(win)};const move=e=>{if(!drag)return;const p=pointer(e);const nx=clamp(ox+(p.x-sx),0,innerWidth-win.offsetWidth);const ny=clamp(oy+(p.y-sy),0,innerHeight-win.offsetHeight-50);Object.assign(win.style,{left:nx+'px',top:ny+'px'})};const up=e=>{if(!drag)return;drag=false;handle.releasePointerCapture?.(e.pointerId);maybeSnap(win)};handle.addEventListener('pointerdown',down);addEventListener('pointermove',move);addEventListener('pointerup',up)}
    function makeResizableWindow(win){const minW=260,minH=170;['n','s','e','w','ne','nw','se','sw'].forEach(edge=>{const el=$('.r-'+edge,win);let sx=0,sy=0,sl=0,st=0,sw=0,sh=0,active=false;const down=e=>{active=true;const p=pointer(e);sx=p.x;sy=p.y;const r=win.getBoundingClientRect();sl=r.left;st=r.top;sw=r.width;sh=r.height;el.setPointerCapture?.(e.pointerId);focusWindow(win)};const move=e=>{if(!active)return;const p=pointer(e);let dx=p.x-sx,dy=p.y-sy;let left=sl,top=st,w=sw,h=sh;if(edge.includes('e'))w=clamp(sw+dx,minW,innerWidth-sl);if(edge.includes('s'))h=clamp(sh+dy,minH,innerHeight-st-50);if(edge.includes('w')){w=clamp(sw-dx,minW,sw+sl);left=sl+(sw-w)}if(edge.includes('n')){h=clamp(sh-dy,minH,sh+st);top=st+(sh-h)}Object.assign(win.style,{left:left+'px',top:top+'px',width:w+'px',height:h+'px'})};const up=e=>{if(!active)return;active=false;el.releasePointerCapture?.(e.pointerId)};el.addEventListener('pointerdown',down);addEventListener('pointermove',move);addEventListener('pointerup',up)})}
    function maybeSnap(win){const r=win.getBoundingClientRect();const m=12;if(Math.abs(r.left-0)<m)win.style.left='0px';if(Math.abs((innerWidth-(r.left+r.width)))<m)win.style.left=(innerWidth-r.width)+'px';if(Math.abs(r.top-0)<m)win.style.top='0px'}
    function downloadResume(){const text=`MOAD ALOUANE\nCybersecurity & Computer Science Student\nEmail: alouanemoad@gmail.com\nLinkedIn: linkedin.com/in/alouanemoad`;const blob=new Blob([text],{type:'text/plain'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='Resume.txt';document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(url),1500)}
    const tasks=$('#tasks');function addTaskButton(id,title){const b=document.createElement('button');b.className='task';b.dataset.id=id;b.textContent=title;b.addEventListener('click',()=>toggleMin(windows.get(id),id));tasks.appendChild(b)}function removeTaskButton(id){const b=tasks.querySelector(`[data-id="${id}"]`);if(b)b.remove()}
    function toggleMin(w,id){if(!w)return;const isMin=w.classList.toggle('min');if(!isMin){focusWindow(w)}else{}}
    const ctx=$('#ctxMenu');desktop.addEventListener('contextmenu',e=>{e.preventDefault();ctx.style.display='block';ctx.style.left=e.clientX+'px';ctx.style.top=e.clientY+'px';ctx.setAttribute('aria-hidden','false')});addEventListener('pointerdown',e=>{if(!ctx.contains(e.target)){ctx.style.display='none';ctx.setAttribute('aria-hidden','true')}});ctx.addEventListener('click',e=>{const btn=e.target.closest('button');if(!btn)return;const a=btn.dataset.action;if(a==='arrange')arrangeIcons();
      if(a==='closeall')closeAll();ctx.style.display='none'});
    
    const startBtn=$('#startBtn');const startMenu=$('#startMenu');startBtn.addEventListener('click',()=>{startMenu.classList.toggle('visible')});addEventListener('pointerdown',e=>{if(!startMenu.contains(e.target)&&e.target!==startBtn)startMenu.classList.remove('visible')});startMenu.addEventListener('click',e=>{const b=e.target.closest('button');if(!b)return;const act=b.dataset.act;
      if(act==='open-about')openWindow('about');
      if(act==='arrange')arrangeIcons();
      if(act==='reset-layout'){store.set('iconPositions_blue',{});arrangeIcons()} 
      if(act==='closeall')closeAll();
      if(act==='quite')window.open('index.html');
      startMenu.classList.remove('visible')});
    
    function arrangeIcons(){const gapX=108,gapY=112;let x=18,y=64;const maxY=innerHeight-210;ICONS.forEach(m=>{const el=$('#icon-'+m.id);if(!el)return;setIconPos(el,x,y);y+=gapY;if(y>maxY){y=64;x+=gapX}});storePositions()}
    function closeAll(){[...windows.keys()].forEach(closeWindow)}
    
    
    const cursor=$('#cursor');let cx=innerWidth/2,cy=innerHeight/2,tx=cx,ty=cy;const coarse=matchMedia('(pointer: coarse)').matches;if(coarse){cursor.style.display='none';document.body.style.cursor='auto'}addEventListener('pointermove',e=>{tx=e.clientX;ty=e.clientY},{passive:true});(function loop(){cx=lerp(cx,tx,0.25);cy=lerp(cy,ty,0.25);cursor.style.left=cx+'px';cursor.style.top=cy+'px';requestAnimationFrame(loop)})()
    function pointer(e){return{x:(e.touches?e.touches[0].clientX:e.clientX),y:(e.touches?e.touches[0].clientY:e.clientY)}}
    addEventListener('keydown',e=>{if(e.key==='Escape'){const arr=[...windows.values()];if(arr.length){const top=arr.sort((a,b)=>(+b.style.zIndex)-(+a.style.zIndex))[0];const id=top.id.replace('win-','');closeWindow(id)}}});

    
    arrangeIcons();
    const ctxM=$('#ctxMenu');
  })();
  </script>

  <!-- Added Media Player Script -->
  <script>
      const songs = [
          'bgm1.mp3', 
          'bgm2.mp3', 
          'bgm3.mp3', 
          'bgm4.mp3', 
          'bgm5.mp3'
      ];
      let currentSongIndex = 0;

      const audioPlayer = document.getElementById('audio-player');
      const playPauseBtn = document.getElementById('play-pause-btn');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      
      const volumeTrack = document.getElementById('volume-track');
      const volumeFill = document.getElementById('volume-fill');
      const volumeNumber = document.getElementById('volume-number');
      
      let isPlaying = false; // Initial state is paused

      // Check if audioPlayer exists before setting properties
      if (audioPlayer) {
          audioPlayer.src = songs[currentSongIndex];
          audioPlayer.volume = 0.24; // Match initial UI
      }

      function loadSong(songIndex) {
          currentSongIndex = songIndex;
          if (audioPlayer) {
              audioPlayer.src = songs[currentSongIndex];
              playSong(); // Automatically play the new song
          }
      }

      function playSong() {
          isPlaying = true;
          if (audioPlayer) {
              audioPlayer.play().catch(e => console.error("Audio play failed:", e));
          }
          if (playPauseBtn) {
              playPauseBtn.textContent = '⏸️';
              playPauseBtn.setAttribute('aria-label', 'Pause Track');
          }
      }

      function pauseSong() {
          isPlaying = false;
          if (audioPlayer) {
              audioPlayer.pause();
          }
          if (playPauseBtn) {
              playPauseBtn.textContent = '▶️';
              playPauseBtn.setAttribute('aria-label', 'Play Track');
          }
      }

      if (playPauseBtn) {
          playPauseBtn.addEventListener('click', () => {
              if (isPlaying) {
                  pauseSong();
              } else {
                  playSong();
              }
          });
      }

      if (nextBtn) {
          nextBtn.addEventListener('click', () => {
              currentSongIndex = (currentSongIndex + 1) % songs.length;
              loadSong(currentSongIndex);
          });
      }

      if (prevBtn) {
          prevBtn.addEventListener('click', () => {
              currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
              loadSong(currentSongIndex);
          });
      }

      if (audioPlayer) {
          audioPlayer.addEventListener('ended', () => {
              if (nextBtn) {
                  nextBtn.click(); // Simulate a click on the next button
              }
          });
      }

      let isDragging = false;

      function updateVolume(event) {
          if (!volumeTrack) return;
          const rect = volumeTrack.getBoundingClientRect();
          const clientY = event.clientY || (event.touches && event.touches[0].clientY);
          if (clientY === undefined) return;

          let y = clientY - rect.top;
          
          let percentage = 100 - (y / rect.height) * 100;

          if (percentage < 0) percentage = 0;
          if (percentage > 100) percentage = 100;

          if (volumeFill) {
              volumeFill.style.height = percentage + '%';
          }
          if (volumeNumber) {
              volumeNumber.textContent = Math.round(percentage);
          }
          
          if (audioPlayer) {
              audioPlayer.volume = percentage / 100;
          }
      }

      if (volumeTrack) {
          volumeTrack.addEventListener('mousedown', (e) => {
              isDragging = true;
              updateVolume(e); // Update on initial click
          });
      }

      document.addEventListener('mousemove', (e) => {
          if (isDragging) {
              updateVolume(e);
          }
      });

      document.addEventListener('mouseup', () => {
          isDragging = false;
      });

      if (volumeTrack) {
          volumeTrack.addEventListener('touchstart', (e) => {
              isDragging = true;
              updateVolume(e);
          });
      }

      document.addEventListener('touchmove', (e) => {
          if (isDragging) {
              e.preventDefault(); 
              updateVolume(e);
          }
      }, { passive: false }); // Need passive: false to call preventDefault

      document.addEventListener('touchend', () => {
          isDragging = false;
      });
  </script>
  <!-- End Media Player Script -->
</body>
</html>
